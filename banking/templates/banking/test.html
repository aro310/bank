{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NovaBank - Client</title>
    <link rel="stylesheet" href="{% static 'banking/dash_client.css' %}">
</head>
<body>

<header>
    <div class="header-text">
        <h2>NovaBank - Client</h2>
        <h3>Bienvenue {{ client.prenom }} {{ client.nom }}</h3>
    </div>
    <div class="header-right">
        <div class="header-logo"></div>
        <div class="client-balance">
            Solde: {{ compte.solde|default:"N/A" }} MGA
        </div>
    </div>
</header>

<nav>
    <ul>
        <li><a href="{% url 'acceuil' %}">Accueil</a></li>
        <li id="operations-link"><a>Opérations <span class="nav-arrow">▼</span></a></li>
        <li id="history-link"><a>Historique des opérations <span class="nav-arrow">▼</span></a></li>
        <li>{{ client.prenom }}</li>
        <li>
            <a href="{% url 'logout' %}" class="btn-logout">
                Quitter
                <svg ...>...</svg>
            </a>
        </li>
    </ul>
</nav>

{% if messages %}
    <div class="messages-container">
        {% for message in messages %}
            <div class="message {{ message.tags }}">{{ message }}</div>
        {% endfor %}
    </div>
{% endif %}


<div class="dropdown-section" id="operationsDropdown">
    <ul>
        <li id="deposit">Dépôts</li>
        <li id="withdrawal">Retraits</li>
    </ul>
    
    <form class="operation-form" id="depositForm" action="{% url 'depot' %}" method="post">
        {% csrf_token %}
        <h4>Dépôt</h4>
        <input type="hidden" name="num_compte" value="{{ compte.num_compte }}">
        <input type="number" name="montant" placeholder="Montant (MGA)" min="0.01" step="0.01" required>
        <button type="submit">Valider</button>
    </form>
    
    <form class="operation-form" id="withdrawalForm" action="{% url 'retrait' %}" method="post">
        {% csrf_token %}
        <h4>Retrait</h4>
        <input type="hidden" name="num_compte" value="{{ compte.num_compte }}">
        <input type="number" name="montant" placeholder="Montant (MGA)" min="0.01" step="0.01" required>
        <button type="submit">Valider</button>
    </form>
</div>

<div class="dropdown-section" id="historyDropdown">
    <div id="historyContainer">
        <table id="historyTable">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Type</th>
                    <th>Montant (MGA)</th>
                    </tr>
            </thead>
            <tbody>
                {% for op in operations %}
                <tr>
                    <td>{{ op.date_heure|date:"d/m/Y H:i" }}</td>
                    <td>{{ op.get_type_operation_display }}</td> <td>{{ op.montant }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="3" style="text-align: center;">Aucune opération récente.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
// --- ON GARDE UNIQUEMENT LE JS QUI GÈRE L'AFFICHAGE (LES MENUS) ---

let operationsLink = document.getElementById('operations-link');
let historyLink = document.getElementById('history-link');
let operationsDropdown = document.getElementById('operationsDropdown');
let historyDropdown = document.getElementById('historyDropdown');
let depositItem = document.getElementById('deposit');
let withdrawalItem = document.getElementById('withdrawal');
let depositForm = document.getElementById('depositForm');
let withdrawalForm = document.getElementById('withdrawalForm');
let historyContainer = document.getElementById('historyContainer');

// Toggle dropdowns
operationsLink.addEventListener('click', () => {
    operationsDropdown.classList.toggle('active');
    operationsLink.classList.toggle('open');
    historyDropdown.classList.remove('active');
    historyLink.classList.remove('open');
    depositForm.classList.remove('show');
    withdrawalForm.classList.remove('show');
    // historyContainer.classList.remove('show'); // On laisse l'historique affiché
});

historyLink.addEventListener('click', () => {
    historyDropdown.classList.toggle('active');
    historyLink.classList.toggle('open');
    operationsDropdown.classList.remove('active');
    operationsLink.classList.remove('open');
    depositForm.classList.remove('show');
    withdrawalForm.classList.remove('show');
    historyContainer.classList.add('show');
});

// Afficher le formulaire correspondant
depositItem.addEventListener('click', () => {
    depositForm.classList.add('show');
    withdrawalForm.classList.remove('show');
});

withdrawalItem.addEventListener('click', () => {
    withdrawalForm.classList.add('show');
    depositForm.classList.remove('show');
});

// --- TOUTE LA LOGIQUE DE GESTION DU SOLDE EN JS EST SUPPRIMÉE ---
// (car elle est maintenant gérée par Django côté serveur)

</script>

</body>
</html>